package net.meltingwax.schemedroid;

import android.app.Activity;
import android.os.Bundle;
import android.view.Display;
import android.view.KeyEvent;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.LinearLayout;
import android.widget.TextView;
import jscheme.JScheme;

/**
 * An Android App Wrapper to JScheme.
 * 
 * @author daniel@meltingwax.net (Daniel da Silva)
 */
public class SchemeDroid extends Activity {
	private static int EVAL_BUTTON_WIDTH = 60;
	
	private JScheme js;
	private TextView console;
	private EditText entry;
	
    /** Called when the activity is first created. */
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        /*
         * Initialize JScheme 
         */
        js = new JScheme();
        
        /*
         * Initialize the View 
         */
        Display display = getWindowManager().getDefaultDisplay();
        
        LinearLayout parentLayout = new LinearLayout(this);
        parentLayout.setOrientation(LinearLayout.VERTICAL);
        parentLayout.setVerticalScrollBarEnabled(true);
        
        console = new TextView(this);
        parentLayout.addView(console);
        
        // The bottom panel that holds the input entry and eval button
        LinearLayout bottomPanel = new LinearLayout(this);
        
        bottomPanel.setOrientation(LinearLayout.HORIZONTAL);        
        entry = new EditText(this);
        entry.setWidth(display.getWidth() - EVAL_BUTTON_WIDTH);
        entry.setOnKeyListener(new View.OnKeyListener() {
			public boolean onKey(View v, int keyCode, KeyEvent event) {
				if (keyCode == KeyEvent.KEYCODE_ENTER) {
					processEntry();
					return true;
				}				
				return false;
			}
		});
        bottomPanel.addView(entry);
        
        Button evalButton = new Button(this);
        evalButton.setWidth(EVAL_BUTTON_WIDTH);
        evalButton.setText("Eval");
        evalButton.setOnClickListener(new View.OnClickListener() {
			public void onClick(View v) {
				processEntry();
			}
		});
        bottomPanel.addView(evalButton);
        
        parentLayout.addView(bottomPanel);
        
        setContentView(parentLayout);
    }
    
    public void processEntry() {
    	String code = entry.getText().toString();
    	
    	if ( ! code.trim().equals("") ) {
    		String resp;
    		
    		try {
    			resp = js.eval(code).toString();
    		} catch (jscheme.SchemeException e) {
    			resp = e.getMessage();
    		}
    		
    		console.append("\n>" + code + "\n" + resp);
    		
    		entry.setText("");
    	}
    }
}